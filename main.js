(()=>{"use strict";function e(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))}function t(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",e)}function n(t){t.classList.add("popup_opened"),document.addEventListener("keydown",e)}var o={url:"https://nomoreparties.co/v1/plus-cohort7",hearders:{authorization:"606c19ec-1c82-4e12-b9a2-b32d3b016e4d","Content-Type":"application/json"}},r=function(e){return e.ok?e.json():Promise.reject(new Error("Ошибка: ".concat(e.status)))},c=function(e){var n=document.querySelector(".form__button_active");e?n.textContent="Сохранение...":(t(document.querySelector(".popup_opened")),n.textContent="Сохранить")},u=function(e){return fetch("".concat(o.url,"/cards/likes/").concat(e),{method:"PUT",headers:o.hearders}).then((function(e){return r(e)})).catch((function(e){return console.log(e),Promise.reject(e)}))},a=function(e){return fetch("".concat(o.url,"/cards/likes/").concat(e),{method:"DELETE",headers:o.hearders}).then((function(e){return r(e)})).catch((function(e){return console.log(e),Promise.reject(e)}))},i=document.querySelector(".popup_type_picture"),l=document.querySelector(".popup__image"),s=document.querySelector(".popup__caption"),d=document.querySelector("#element").content,m=document.querySelector(".popup_type_delete"),f=function(e){var t=d.querySelector(".element").cloneNode(!0),o=t.querySelector(".element__image"),r=t.querySelector(".element__like"),c=t.querySelector(".element__trash"),f=t.querySelector(".element__title"),_=t.querySelector(".element__like-count");return _.textContent=0,o.src=e.link,o.alt="фото ".concat(e.name),f.textContent=e.name,t.id=e._id,c.classList.add("element__trash_active"),c.addEventListener("click",(function(){t.classList.add("element_active"),n(m)})),r.addEventListener("click",(function(e){e.target.classList.toggle("element__like_active"),e.target.classList.contains("element__like_active")?u(t.id).then((function(e){_.textContent=e.likes.length})):a(t.id).then((function(e){_.textContent=e.likes.length}))})),o.addEventListener("click",(function(e){l.src=e.target.src,s.textContent=f.textContent,l.alt="фото ".concat(s.textContent),n(i)})),t},_={form:".form",inputForm:".form__input",submitButtonForm:".form__button",setForm:".form__set",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active",inactiveButtonClass:"form__button_inactive",buttonOpacity:"button-opacity"},p=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.classList.add(n.buttonOpacity),t.disabled=!1,t.classList.add("form__button_active")):(t.classList.add(n.inactiveButtonClass),t.classList.remove(n.buttonOpacity),t.disabled=!0)},y=document.querySelectorAll(".popup"),h=document.querySelector(".popup_type_profile"),v=document.querySelector(".popup_type_card-add"),S=document.querySelector(".popup_type_avatar"),q=document.querySelector(".profile__button-edit"),g=document.querySelector(".profile__button-add"),L=document.querySelector(".profile__avatar-cover"),k=document.querySelector(".form_type_profile"),C=k.querySelector(".form__input_type_name"),b=k.querySelector(".form__input_type_hobby"),E=document.querySelector(".form_type_card"),x=Array.from(E.querySelectorAll(_.inputForm)),P=E.querySelector(_.submitButtonForm),j=E.querySelector(".form__input_type_title"),A=E.querySelector(".form__input_type_link"),F=document.querySelector(".profile__avatar-pucture"),O=document.querySelector(".form_type_avatar"),T=O.querySelector(".form__input_type_avatar"),B=document.querySelector(".profile__name"),D=document.querySelector(".profile__hobby"),N=document.querySelector(".form_type_delete"),w=document.querySelector(".elements"),J="";fetch("".concat(o.url,"/users/me"),{headers:o.hearders}).then((function(e){return r(e)})).catch((function(e){return console.log(e),Promise.reject(e)})).then((function(e){J=e._id,B.textContent=e.name,D.textContent=e.about,F.src=e.avatar})).catch((function(e){console.log("Ошибка загрузки профиля",e.message)})),fetch("".concat(o.url,"/cards"),{headers:o.hearders}).then((function(e){return r(e)})).catch((function(e){return console.log(e),Promise.reject(e)})).then((function(e){e.forEach((function(e){var t=e.likes.filter((function(e){return e._id===J}));e.owner._id===J?w.append(f(e)):w.append(function(e,t){var o=d.querySelector(".element").cloneNode(!0),r=o.querySelector(".element__image"),c=o.querySelector(".element__like"),m=o.querySelector(".element__title"),f=o.querySelector(".element__like-count");return f.textContent=e.likes.length,r.src=e.link,r.alt="фото ".concat(e.name),m.textContent=e.name,o.id=e._id,t&&c.classList.add("element__like_active"),c.addEventListener("click",(function(e){e.target.classList.toggle("element__like_active"),e.target.classList.contains("element__like_active")?u(o.id).then((function(e){f.textContent=e.likes.length})):a(o.id).then((function(e){f.textContent=e.likes.length}))})),r.addEventListener("click",(function(e){l.src=e.target.src,s.textContent=m.textContent,l.alt="фото ".concat(s.textContent),n(i)})),o}(e,t.length>0))}))})).catch((function(e){console.log("Ошибка загрузки карточек",e.message)})),function(e){Array.from(document.querySelectorAll(e.form)).forEach((function(t){Array.from(t.querySelectorAll(e.setForm)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputForm)),o=e.querySelector(t.submitButtonForm);p(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),p(n,o,t)}))}))}(t,e)}))}))}(_),L.addEventListener("click",(function(){n(S)})),q.addEventListener("click",(function(){C.value=B.textContent,b.value=D.textContent,n(h)})),g.addEventListener("click",(function(){p(x,P,_),n(v)})),y.forEach((function(e){e.addEventListener("click",(function(n){(n.target.classList.contains("popup")||n.target.classList.contains("popup__close"))&&t(e)}))})),E.addEventListener("submit",(function(e){var t;e.preventDefault(),(t={name:j.value,link:A.value},c(!0),fetch("".concat(o.url,"/cards"),{method:"POST",headers:o.hearders,body:JSON.stringify({name:t.name,link:t.link})}).then((function(e){return r(e)})).catch((function(e){return console.log(e),Promise.reject(e)})).finally((function(){c(!1)}))).then((function(e){w.prepend(f(e))})).catch((function(e){console.log("Ошибка создания карточки",e.message)})),E.reset()})),O.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=T,c(!0),fetch("".concat(o.url,"/users/me/avatar"),{method:"PATCH",headers:o.hearders,body:JSON.stringify({avatar:t.value})}).then((function(e){return r(e)})).catch((function(e){return console.log(e),Promise.reject(e)})).finally((function(){c(!1)}))).then((function(e){F.src=e.avatar})).catch((function(e){console.log("Ошибка изменения аватара",e.message)}))})),k.addEventListener("submit",(function(e){var t;e.preventDefault(),(t={name:C.value,about:b.value},c(!0),fetch("".concat(o.url,"/users/me"),{method:"PATCH",headers:o.hearders,body:JSON.stringify({name:t.name,about:t.about})}).then((function(e){return r(e)})).catch((function(e){return console.log(e),Promise.reject(e)})).finally((function(){c(!1)}))).then((function(e){B.textContent=e.name,D.textContent=e.about})).catch((function(e){console.log("Ошибка изменения профиля",e.message)}))})),N.addEventListener("submit",(function(e){e.preventDefault();var n=document.querySelector(".element_active");(function(e){return fetch("".concat(o.url,"/cards/").concat(e.id),{method:"DELETE",headers:o.hearders}).then((function(e){return r(e)})).catch((function(e){return console.log(e),Promise.reject(e)})).finally((function(){t(document.querySelector(".popup_opened"))}))})(n).then(n.remove()).catch((function(e){console.log("Ошибка удаления карточки",e.message)}))}))})();